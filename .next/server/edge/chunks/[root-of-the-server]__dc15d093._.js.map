{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\nimport { NextResponse, type NextRequest } from \"next/server\";\n\nexport async function middleware(request: NextRequest) {\n  return await updateSession(request);\n}\n\nexport const config = {\n  matcher: [\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n  ],\n};\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  });\n\n  const supabase = createServerClient(\n    process.env.SUPABASE_URL!,\n    process.env.SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) =>\n            request.cookies.set(name, value),\n          );\n          supabaseResponse = NextResponse.next({\n            request,\n          });\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options),\n          );\n        },\n      },\n    },\n  );\n\n  const isAuthRoute =\n    request.nextUrl.pathname === \"/login\" ||\n    request.nextUrl.pathname === \"/sign-up\";\n\n  if (isAuthRoute) {\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    if (user) {\n      return NextResponse.redirect(\n        new URL(\"/\", process.env.NEXT_PUBLIC_BASE_URL),\n      );\n    }\n  }\n\n  const { searchParams, pathname } = new URL(request.url);\n\n  if (!searchParams.get(\"noteId\") && pathname === \"/\") {\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n\n    if (user) {\n      const { newestNoteId } = await fetch(\n        `${process.env.NEXT_PUBLIC_BASE_URL}/api/fetch-newest-note?userId=${user.id}`,\n      ).then((res) => res.json());\n\n      if (newestNoteId) {\n        const url = request.nextUrl.clone();\n        url.searchParams.set(\"noteId\", newestNoteId);\n        return NextResponse.redirect(url);\n      } else {\n        const { noteId } = await fetch(\n          `${process.env.NEXT_PUBLIC_BASE_URL}/api/create-new-note?userId=${user.id}`,\n          {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n          },\n        ).then((res) => res.json());\n        const url = request.nextUrl.clone();\n        url.searchParams.set(\"noteId\", noteId);\n        return NextResponse.redirect(url);\n      }\n    }\n  }\n\n  return supabaseResponse;\n}"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,OAAO,MAAM,cAAc;AAC7B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH;AAEO,eAAe,cAAc,OAAoB;IACtD,IAAI,mBAAmB,4TAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,MAAM,WAAW,CAAA,GAAA,8RAAA,CAAA,qBAAkB,AAAD,EAChC,QAAQ,GAAG,CAAC,YAAY,EACxB,QAAQ,GAAG,CAAC,iBAAiB,EAC7B;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACnC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE5B,mBAAmB,4TAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBACnC;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE9C;QACF;IACF;IAGF,MAAM,cACJ,QAAQ,OAAO,CAAC,QAAQ,KAAK,YAC7B,QAAQ,OAAO,CAAC,QAAQ,KAAK;IAE/B,IAAI,aAAa;QACf,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAC/B,IAAI,MAAM;YACR,OAAO,4TAAA,CAAA,eAAY,CAAC,QAAQ,CAC1B,IAAI,IAAI;QAEZ;IACF;IAEA,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAEtD,IAAI,CAAC,aAAa,GAAG,CAAC,aAAa,aAAa,KAAK;QACnD,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,MAAM;YACR,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,MAC7B,6DAAoC,8BAA8B,EAAE,KAAK,EAAE,EAAE,EAC7E,IAAI,CAAC,CAAC,MAAQ,IAAI,IAAI;YAExB,IAAI,cAAc;gBAChB,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,YAAY,CAAC,GAAG,CAAC,UAAU;gBAC/B,OAAO,4TAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;YAC/B,OAAO;gBACL,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,MACvB,6DAAoC,4BAA4B,EAAE,KAAK,EAAE,EAAE,EAC3E;oBACE,QAAQ;oBACR,SAAS;wBACP,gBAAgB;oBAClB;gBACF,GACA,IAAI,CAAC,CAAC,MAAQ,IAAI,IAAI;gBACxB,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;gBACjC,IAAI,YAAY,CAAC,GAAG,CAAC,UAAU;gBAC/B,OAAO,4TAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;YAC/B;QACF;IACF;IAEA,OAAO;AACT"}}]
}